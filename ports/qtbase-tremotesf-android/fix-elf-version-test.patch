From 8796677de8900dc154aef45f8620c3f987a40291 Mon Sep 17 00:00:00 2001
From: Thiago Macieira <thiago.macieira@intel.com>
Date: Sat, 25 Feb 2023 09:20:56 -0800
Subject: [PATCH] CMake: provide the symbol "sym" which we're setting ELF versions for

The ELF version scripts set the version for this symbol, but we were
failing to create the symbol in the .o file in the first place.

Pick-to: 6.2 6.4 6.4.3 6.5
Task-number: QTBUG-111514
Patch-by: Bernhard Rosenkr√§nzer <bero@lindev.ch>
Change-Id: Ieec322d73c1e40ad95c8fffd1747210caf0ce66a
---

diff --git a/cmake/QtBaseConfigureTests.cmake b/cmake/QtBaseConfigureTests.cmake
index b792942..aae802f 100644
--- a/cmake/QtBaseConfigureTests.cmake
+++ b/cmake/QtBaseConfigureTests.cmake
@@ -132,7 +132,7 @@
         set(CMAKE_REQUIRED_LINK_OPTIONS ${linker_flags})
     endif()
 
-    check_cxx_source_compiles("int main(void){return 0;}" HAVE_LD_VERSION_SCRIPT)
+    check_cxx_source_compiles("int sym; int main(void){return 0;}" HAVE_LD_VERSION_SCRIPT)
     if(DEFINED CMAKE_REQUIRED_FLAGS_SAVE)
         set(CMAKE_REQUIRED_FLAGS ${CMAKE_REQUIRED_FLAGS_SAVE})
     endif()
